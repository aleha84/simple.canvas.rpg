function Box(n,t){this.topLeft=n;this.size=t;this.center=new Vector2(this.topLeft.x+t.x/2,this.topLeft.y+t.y/2);this.bottomRight=new Vector2(this.topLeft.x+this.size.x,this.topLeft.y+this.size.y);this.topRight=new Vector2(this.bottomRight.x,this.topLeft.y);this.bottomLeft=new Vector2(this.topLeft.x,this.bottomRight.y);this.update=function(n,t){this.topLeft=n;t!==undefined&&(this.size=t);this.center=new Vector2(this.topLeft.x+this.size.x/2,this.topLeft.y+this.size.y/2);this.bottomRight=new Vector2(this.topLeft.x+this.size.x,this.topLeft.y+this.size.y)};this.isPointInside=function(n){return n instanceof Vector2&&this.topLeft.x<=n.x&&n.x<=this.bottomRight.x&&this.topLeft.y<=n.y&&n.y<=this.bottomRight.y};this.isIntersectsWithCircle=function(n){return boxCircleIntersects(n,this)};this.isIntersectsWithBox=function(n){return boxIntersectsBox(this,n)};this.render=function(n){var t={fillStyle:"rgba(0, 255, 0, 0.5)",lineWidth:1,strokeStyle:"#00FF00"};isBoolean(n)?t.fill=n:extend(t,n);SCG.context.beginPath();SCG.context.rect(this.topLeft.x,this.topLeft.y,this.size.x,this.size.y);t.fill&&(SCG.context.fillStyle=t.fillStyle,SCG.context.fill());SCG.context.lineWidth=t.lineWidth;SCG.context.strokeStyle=t.strokeStyle;SCG.context.closePath();SCG.context.stroke()}}(function(){"use strict";var i=typeof module!="undefined"&&module.exports,r=typeof Element!="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){for(var t,r,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,f=i.length,u={};n<f;n++)if(t=i[n],t&&t[1]in document){for(n=0,r=t.length;n<r;n++)u[i[0][n]]=t[n];return u}return!1}(),t={request:function(t){var i=n.requestFullscreen;t=t||document.documentElement;/5\.1[\.\d]* Safari/.test(navigator.userAgent)?t[i]():t[i](r&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(n){this.isFullscreen?this.exit():this.request(n)},raw:n};if(!n){i?module.exports=!1:window.screenfull=!1;return}Object.defineProperties(t,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[n.fullscreenEnabled]}}});i?module.exports=t:window.screenfull=t})();String.format||(String.format=function(n){var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})});var SCG={test:"test"};SCG.AI={};SCG.space=undefined;SCG.viewfield={"default":{width:500,height:300},width:500,height:300,current:undefined};SCG.canvas=undefined;SCG.canvasId="mainCanvas";SCG.canvasBg=undefined;SCG.canvasBgId="backgroundCanvas";SCG.canvasUI=undefined;SCG.canvasUIId="uiCanvas";SCG.context=undefined;SCG.contextBg=undefined;SCG.contextUI=undefined;SCG.gameLogics={isPaused:!1,isPausedStep:!1,gameOver:!1,wrongDeviceOrientation:!1,messageToShow:"",isMobile:!1,pausedFrom:undefined,pauseDelta:0,doPauseWork:function(n){this.isPaused&&this.pausedFrom==undefined?(this.pausedFrom=n,this.pauseDelta=0):this.pausedFrom==undefined||this.isPaused?this.pauseDelta!=0&&(this.pauseDelta=0):(this.pauseDelta=n-this.pausedFrom,this.pausedFrom=undefined)},pauseToggle:function(){SCG.gameLogics.isPaused=!SCG.gameLogics.isPaused;SCG.UI.invalidate();SCG.audio&&SCG.audio.playPause(SCG.gameLogics.isPaused)}};SCG.go=[];SCG.gameControls={scale:{times:1},selectedGOs:[],storage:{savePrefix:"SCG_save_",save:function(n,t){t!=undefined&&localStorage.setItem(this.savePrefix+n,JSON.stringify(t))},load:function(n){var t=localStorage.getItem(this.savePrefix+n);return t==null?undefined:JSON.parse(t)},list:function(){}},camera:{mode:"free",shiftSpeed:5,centeredOn:undefined,resetAfterUpdate:!1,preventModeSwitch:!1,shifts:{left:!1,right:!1,up:!1,down:!1},free:function(){this.preventModeSwitch||(SCG.gameControls.camera.mode="free",this.centeredOn=undefined)},center:function(n){if(!this.preventModeSwitch){var t=SCG.gameControls;n==undefined&&t.selectedGOs.length==1&&(n=t.selectedGOs[0]);n?(t.camera.mode="centered",this.centeredOn=n):this.free()}},reset:function(){var n=this.shifts;n.left=!1;n.right=!1;n.up=!1;n.down=!1},update:function(){var i=this.shifts,n=undefined,t,r;this.mode==="free"?(t=undefined,i.left&&(t=V2.left()),i.right&&(t=V2.right()),i.up&&(t!=undefined?t.add(V2.up()):t=V2.up()),i.down&&(t!=undefined?t.add(V2.down()):t=V2.down()),t!==undefined&&(r=t.mul(this.shiftSpeed),n=SCG.viewfield.current.topLeft.add(r))):this.mode==="centered"&&this.centeredOn!==undefined&&(n=this.centeredOn.position.substract(new V2(SCG.viewfield.default.width/2,SCG.viewfield.default.height/2)));this.resetAfterUpdate&&this.reset();n!=undefined&&(n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x+SCG.viewfield.current.size.x>SCG.space.width&&(n.x=SCG.space.width-SCG.viewfield.current.size.x),n.y+SCG.viewfield.current.size.y>SCG.space.height&&(n.y=SCG.space.height-SCG.viewfield.current.size.y),SCG.viewfield.current.update(n))}},mousestate:{position:new V2,delta:new V2,leftButtonDown:!1,rightButtonDown:!1,middleButtonDown:!1,timer:undefined,reset:function(){this.leftButtonDown=!1;this.rightButtonDown=!1;this.middleButtonDown=!1},stopped:function(){SCG.gameControls.mousestate.delta=new V2},toString:function(){return"position: "+this.position.toString()+"<br/>leftButtonDown: "+this.leftButtonDown},doClickCheck:function(){for(var n,u,t,i=SCG.gameControls,r=0;r<this.eventHandlers.click.length;r++)if(n=this.eventHandlers.click[r],n.renderBox!=undefined&&n.renderBox.isPointInside(i.mousestate.position)&&n.handlers!=undefined&&n.handlers.click!=undefined&&isFunction(n.handlers.click)){if(u=n.handlers.click.call(n),u&&u.preventBubbling)return;break}t=SCG.scenes.activeScene.game;t.clickHandler!=undefined&&isFunction(t.clickHandler)&&t.clickHandler(i.mousestate.position.division(i.scale.times))},eventHandlers:{click:[]}},keyboardstate:{altPressed:!1,shiftPressed:!1,ctrlPressed:!1},mouseDown:function(n){var t=SCG.gameControls.mousestate;if(n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(t.leftButtonDown=!0);else switch(n.which){case 1:t.leftButtonDown=!0;break;case 2:t.middleButtonDown=!0;break;case 3:t.rightButtonDown=!0;break;default:t.reset()}},mouseOut:function(){SCG.gameControls.mousestate.reset()},mouseUp:function(n){var i=this,t=SCG.gameControls.mousestate;if(i.getEventAbsolutePosition(n),n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(t.leftButtonDown=!1);else switch(n.which){case 1:t.leftButtonDown=!1;break;case 2:t.middleButtonDown=!1;break;case 3:t.rightButtonDown=!1;break;default:t.reset()}i.mousestate.doClickCheck();n.preventDefault()},mouseMove:function(n){var i=this,t=SCG.gameControls.mousestate,r=t.position.clone();i.getEventAbsolutePosition(n);t.delta=t.position.substract(r);SCG.debugger&&SCG.debugger.setValue(t.toString())},getEventAbsolutePosition:function(n){var t=pointerEventToXY(n);SCG.gameControls.mousestate.position=new V2(t.x-SCG.canvasUI.margins.left,t.y-SCG.canvasUI.margins.top)},orientationChangeEventInit:function(){var n=this;SCG.gameControls.permanentEventInit();addListenerMulti(window,"orientationchange resize",function(){n.graphInit()});SCG.gameLogics.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);SCG.gameLogics.isMobile&&(setTimeout(function(){window.scrollTo(0,1)},100),addListenerMulti(document,"fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){n.graphInit()}));this.graphInit()},graphInit:function(){var t=SCG.gameLogics,n=SCG.viewfield,s,i,r,o;if(t.messageToShow="",t.wrongDeviceOrientation=!window.matchMedia("(orientation: landscape)").matches,t.wrongDeviceOrientation){t.messageToShow="wrong device orientation - portrait";return}if(s=window.innerWidth,s<n.default.width){t.messageToShow=String.format("width lesser than {3} (width: {0}, iH: {1}, iW: {2})",s,window.innerHeight,window.innerWidth,n.default.width);t.wrongDeviceOrientation=!0;return}var u=Math.max(document.documentElement.clientWidth,window.innerWidth||0),f=Math.max(document.documentElement.clientHeight,window.innerHeight||0),h=u/n.default.width,c=f/n.default.height,e=SCG.gameControls.scale;if(e.times=Math.min(h,c),e.times<1){t.messageToShow=String.format("window is to small (width: {0}, height: {1})",u,f);t.wrongDeviceOrientation=!0;return}n.width=n.default.width*e.times;n.height=n.default.height*e.times;i=0;r=0;n.width<u?r=Math.round((u-n.width)/2):n.height<f&&(i=Math.round((f-n.height)/2));this.setCanvasProperties(SCG.canvas,i,r);this.setCanvasProperties(SCG.canvasBg,i,r);this.setCanvasProperties(SCG.canvasUI,i,r);o=SCG.scenes.activeScene.backgroundRender;o!=undefined&&isFunction(o)&&o();SCG.UI.invalidate()},setCanvasProperties:function(n,t,i){var r=SCG.viewfield;setAttributes(n,{width:r.width,height:r.height,css:{width:r.width+"px",height:r.height+"px","margin-top":t+"px","margin-left":i+"px"}});n.width=r.width;n.height=r.height;n.margins={top:t,left:i}},permanentEventInit:function(){var n=this;document.addEventListener("keydown",function(t){n.permanentKeyDown(t)},!1);document.addEventListener("keyup",function(t){n.permanentKeyUp(t)},!1);addListenerMulti(SCG.canvasUI,"mousedown touchstar",function(t){absorbTouchEvent(t);t.type=="touchstart"&&n.mouseMove(t);n.mouseDown(t)});addListenerMulti(SCG.canvasUI,"mouseup touchend",function(t){absorbTouchEvent(t);n.mouseUp(t)});addListenerMulti(SCG.canvasUI,"mouseout touchleave",function(t){absorbTouchEvent(t);n.mouseOut(t)});addListenerMulti(SCG.canvasUI,"mousemove touchmove",function(t){absorbTouchEvent(t);n.mouseMove(t)});SCG.canvasUI.addEventListener("contextmenu",function(n){return n.preventDefault(),!1},!1)},permanentKeyDown:function(n){var t=this.keyboardstate;t.shiftPressed=n.shiftKey;t.ctrlPressed=n.ctrlKey;t.altPressed=n.altKey},permanentKeyUp:function(n){var t=this.keyboardstate;t.shiftPressed=n.shiftKey;t.ctrlPressed=n.ctrlKey;t.altPressed=n.altKey;switch(n.which){case 32:n.shiftKey?SCG.gameLogics.isPausedStep=!0:SCG.gameLogics.pauseToggle()}}};SCG.GO={};SCG.GO.GO=function(n){if(this.defaultInitProperties={},this.position=new V2,this.renderPosition=new V2,this.renderBox=undefined,this.alive=!0,this.static=!1,this.type="unidentifiedType",this.id="",this.size=new V2,this.renderSize=new V2,this.direction=new V2,this.speed=0,this.angle=0,this.context=undefined,this.contextName="context",this.img=undefined,this.imgPropertyName=undefined,this.selected=!1,this.playerControllable=!1,this.destination=undefined,this.path=[],this.mouseOver=!1,this.randomizeDestination=!1,this.randomizeDestinationRadius=new V2,this.setDeadOnDestinationComplete=!1,this.isCustomRender=!1,this.handlers={},this.isAnimated=!1,this.animation={totalFrameCount:0,framesInRow:0,framesRowsCount:0,frameChangeDelay:0,destinationFrameSize:new V2,sourceFrameSize:new V2,currentDestination:new V2,currentFrame:0,reverse:!1,paused:!1,loop:!1,animationTimer:undefined,animationEndCallback:function(){},frameChange:function(){var n=this.animation,t,i;if(!n.paused){if(n.reverse?n.currentFrame--:n.currentFrame++,!n.reverse&&n.currentFrame>n.totalFrameCount||n.reverse&&n.currentFrame<1)if(n.loop)n.currentFrame=n.reverse?n.totalFrameCount:1;else{n.animationEndCallback.call(this);return}t=Math.ceil(n.currentFrame/n.framesInRow);i=n.framesInRow-(t*n.framesInRow-n.currentFrame);n.currentDestination=new V2(i-1,t-1)}}},n==undefined)throw"SCG.GO.GO -> props are undefined";if(n.size==undefined||n.size.equal(new V2))throw"SCG.GO.GO -> size is undefined";extend(!0,this,n);this.isAnimated&&(this.size=this.animation.destinationFrameSize.clone(),this.animation.currentFrame=0,this.animation.animationTimer={lastTimeWork:new Date,delta:0,currentDelay:this.animation.frameChangeDelay,originDelay:this.animation.frameChangeDelay,doWorkInternal:this.animation.frameChange,context:this});SCG.GO.GO.counter[this.type]==undefined&&(SCG.GO.GO.counter[this.type]=0);this.id=this.type+ ++SCG.GO.GO.counter[this.type];this.creationTime=new Date;this.regClick();this.initializer!=undefined&&isFunction(this.initializer)&&this.initializer(this);this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName]);SCG.AI.worker&&SCG.AI.sendEvent({type:"created",message:{goType:this.type,id:this.id,position:this.position.clone()}})};SCG.GO.GO.counter={};SCG.GO.GO.prototype={constructor:SCG.GO.GO,beforeDead:function(){},setDead:function(){this.beforeDead();var n=SCG.gameControls.mousestate.eventHandlers,t=n.click.indexOf(this);t>-1&&n.click.splice(t,1);SCG.AI.worker&&SCG.AI.sendEvent({type:"removed",message:{goType:this.type,id:this.id}});this.alive=!1},isAlive:function(){return this.alive},render:function(){var t,f;if(!this.alive||!this.renderPosition)return!1;if(this.internalPreRender(),this.isCustomRender)this.customRender();else if(this.img!=undefined){var i=this.renderPosition,n=this.renderSize,r=this.destSourcePosition,e=this.size,u=this.context;this.isAnimated?(t=this.animation,u.drawImage(this.img,t.currentDestination.x*t.sourceFrameSize.x,t.currentDestination.y*t.sourceFrameSize.y,t.sourceFrameSize.x,t.sourceFrameSize.y,i.x-n.x/2,i.y-n.y/2,n.x,n.y)):r!=undefined?(f=this.destSourceSize?this.destSourceSize:this.size,u.drawImage(this.img,r.x,r.y,f.x,f.y,i.x-n.x/2,i.y-n.y/2,n.x,n.y)):u.drawImage(this.img,i.x-n.x/2,i.y-n.y/2,n.x,n.y)}this.internalRender()},customRender:function(){},internalPreRender:function(){},internalRender:function(){},update:function(n){var t=SCG.gameControls.scale;if(this.renderSize=this.size.mul(t.times),this.box=new Box(new V2(this.position.x-this.size.x/2,this.position.y-this.size.y/2),this.size),this.renderPosition=undefined,(SCG.viewfield.current.isIntersectsWithBox(this.box)||this.static)&&(this.renderPosition=this.position.add(this.static?new V2:SCG.viewfield.current.topLeft.mul(-1)).mul(t.times),this.renderBox=new Box(new V2(this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2),this.renderSize)),this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName],this.img==undefined))throw"Cant achieve image named: "+this.imgPropertyName;if(this.context==undefined&&this.contextName!=undefined&&(this.context=SCG.contexts[this.contextName],this.context==undefined))throw"Cant achieve context named: "+this.contextName;if(!this.static&&(!this.alive||SCG.gameLogics.isPaused||SCG.gameLogics.gameOver||SCG.gameLogics.wrongDeviceOrientation)||(this.mouseOver=!1,this.internalPreUpdate(n),!this.alive))return!1;if(this.destination&&(this.position.distance(this.destination)<=this.speed?this.setDestination():this.position.add(this.direction.mul(this.speed),!0)),this.destination==undefined)if(this.path.length>0)this.setDestination(this.path.shift());else if(this.setDeadOnDestinationComplete)return this.setDead(),!1;return this.isAnimated&&doWorkByTimer(this.animation.animationTimer,n),this.internalUpdate(n),this.alive?void 0:!1},internalPreUpdate:function(){},internalUpdate:function(){},setDestination:function(n){if(n!==undefined&&n instanceof V2){if(this.randomizeDestination){var t=this.randomizeDestinationRadius;n.add(new V2(getRandom(-t,t),getRandom(-t,t)),!0)}this.destination=n;this.direction=this.position.direction(this.destination)}else this.destination=undefined,this.direction=new V2},renderSelectBox:function(){var n=this.selectBoxColor;n===undefined&&(n={max:255,min:100,current:255,direction:1,step:1,colorPattern:"rgb({0},0,0)"},this.playerControllable&&(n.colorPattern="rgb(0,{0},0)"));this.renderBox.render({fill:!1,strokeStyle:String.format(n.colorPattern,n.current),lineWidth:2});(n.current>=n.max||n.current<=n.min)&&(n.direction*=-1);n.current+=n.step*n.direction},clickHandler:function(){},regClick:function(){if(this.handlers.click&&isFunction(this.handlers.click)){var n=SCG.gameControls.mousestate.eventHandlers;n.click.indexOf(this)==-1&&n.click.push(this)}}};SCG.GO.goBaseProperties={};SCG.GO.create=function(n,t){if(n==undefined)throw"SCG.GO.create -> name is empty";t==undefined&&(t={});var i=SCG.GO.goBaseProperties[n];if(i==undefined)throw"SCG.GO.create -> can't find base properties ba provided name "+n;return new SCG.GO.GO(extend(!0,{},i,t))};SCG.GO.register=function(n,t){if(n==undefined)throw"SCG.GO.register -> name is empty";if(t==undefined)throw"SCG.GO.register -> baseProperties is undefined";SCG.GO.goBaseProperties[n]=t};SCG.src={};SCG.images={};SCG.contexts={};SCG.globals={addDefaultUIButtons:!0};SCG.customInitializaers=[];window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();SCG.initializer=function(n){var r=0,i=0;for(var t in SCG.src)i++;for(t in SCG.src)SCG.images[t]=new Image,SCG.images[t].onload=function(){++r>=i&&n()},SCG.images[t].src=SCG.src[t];i==0&&n()};SCG.customInitialization=function(){if(SCG.customInitializaers.length!=0)for(var n=0;n<SCG.customInitializaers.length;n++)isFunction(SCG.customInitializaers[n])&&SCG.customInitializaers[n]()};SCG.scenes={activeScene:undefined,scenes:{},selectScene:function(n,t){if(this.scenes[n]==undefined)throw String.format("Scene {0} not found!",n);this.activeScene&&this.activeScene.dispose&&this.activeScene.dispose();this.activeScene=this.scenes[n];var i=this.activeScene,r=SCG.gameControls.mousestate.eventHandlers;r.click=[];i.go.forEach(function(n){n.regClick()});SCG.contextBg&&(SCG.contextBg.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height),i.backgroundRender!=undefined&&isFunction(i.backgroundRender)&&i.backgroundRender());SCG.AI.initialize();i.ui=[];SCG.globals.addDefaultUIButtons&&SCG.UI.addDefaultUIButtons();SCG.contextUI&&SCG.UI.invalidate();SCG.space={width:i.space.width,height:i.space.height};i.start!=undefined&&isFunction(i.start)&&i.start(t)},registerScene:function(n){var t,i,r;if(n.name===undefined)throw"Can't register scene without name";if(t=n.gameObjectsBaseProperties,t!=undefined&&isArray(t))for(i=0;i<t.length;i++){if(r=t[i].type,SCG.GO.goBaseProperties[r]!=undefined)throw String.format("SCG.scenes.registerScene -> BaseProperty with type '{0} already registered'",r);SCG.GO.register(r,t[i])}this.scenes[n.name]={name:n.name,start:n.start!==undefined&&isFunction(n.start)?n.start:undefined,dispose:n.dispose!==undefined&&isFunction(n.dispose)?n.dispose:undefined,preMainWork:n.preMainWork!==undefined&&isFunction(n.preMainWork)?n.preMainWork.bind(this):undefined,afterMainWork:n.afterMainWork!==undefined&&isFunction(n.afterMainWork)?n.afterMainWork.bind(this):undefined,go:n.gameObjectGenerator!=undefined&&isFunction(n.gameObjectGenerator)?n.gameObjectGenerator():[],backgroundRender:n.backgroundRender!=undefined&&isFunction(n.backgroundRender)?n.backgroundRender:undefined,game:extend(!0,{},n.game),space:n.space?n.space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},ui:[],unshift:[]}}};SCG.AI.initialize=function(){SCG.AI.worker&&(SCG.AI.worker.terminate(),SCG.AI.worker=undefined,URL.revokeObjectURL(SCG.AI.blobURL));var n=SCG.scenes.activeScene.game;n&&n.AI&&(SCG.AI.blobURL=URL.createObjectURL(new Blob(["(","function(){var queue = [];\nconsole.log('worker start');\nvar queueProcesser =\n"+(n.AI.queueProcesser!=undefined&&isFunction(n.AI.queueProcesser)?n.AI.queueProcesser.toString():"function(){}")+"\nfunction processMessageQueue(){\nif(queue.length > 0){\nqueueProcesser();\n}\nsetTimeout(processMessageQueue, 100);\n}\nself.onmessage = function(e){\nvar msg = e.data;\nswitch(msg.command){\ncase 'event':\nqueue.push(msg.event);\nbreak;\ncase 'initialize':\nself.environment=msg.environment;\nself.importScripts(msg.url + 'utils.min.js');\nqueue.push({type: 'start', message: undefined})\nbreak;\ndefault:\nbreak;\n}\n}\nprocessMessageQueue();\n}",")()"],{type:"application/javascript"})),SCG.AI.worker=new Worker(SCG.AI.blobURL));SCG.AI.worker&&n.AI.messagesProcesser!=undefined&&isFunction(n.AI.messagesProcesser)&&(SCG.AI.worker.onmessage=function(t){n.AI.messagesProcesser(t.data)})};SCG.AI.initializeEnvironment=function(n){var t=document.location.href,i=t.indexOf("index");i!=-1&&(t=t.substring(0,i));SCG.AI.worker.postMessage({command:"initialize",environment:n,url:t})};SCG.AI.sendEvent=function(n){SCG.AI.worker.postMessage({command:"event",event:n})};SCG.UI={initialized:!1,invalidate:function(){if(SCG.contextUI){SCG.contextUI.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height);for(var n=SCG.scenes.activeScene,t=n.ui.length;t--;)n.ui[t].update(),n.ui[t].render()}},addDefaultUIButtons:function(){var u=SCG.scenes.activeScene,n=SCG.viewfield.default,t=SCG.GO.create("button",{position:new Vector2,isFullscreen:!1,transparency:.75,handlers:{click:function(){return this.isFullscreen=!this.isFullscreen,screenfull.toggle(document.documentElement),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size,t=this.innerCanvasContext;t.clearRect(0,0,n.x,n.y);drawFigures(t,this.isFullscreen?[[new Vector2(0,n.y*.475),new Vector2(n.x*.475,0),new Vector2(n.x*.475,n.y*.475)],[new Vector2(n.x*.525,n.y*.525),new Vector2(n.x,n.y*.525),new Vector2(n.x*.525,n.y)]]:[[new Vector2(0,0),new Vector2(n.x*.75,0),new Vector2(0,n.y*.75)],[new Vector2(n.x*.25,n.y),new Vector2(n.x,n.y),new Vector2(n.x,n.y*.25)]],{alpha:this.transparency,fill:"darkgrey"})}}),i,r;t.position=new Vector2(n.width-t.size.x/2,n.height-t.size.y/2);u.ui.push(t);i=SCG.GO.create("button",{position:new Vector2,transparency:.75,handlers:{click:function(){return SCG.gameLogics.pauseToggle(),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size,t=this.innerCanvasContext;t.clearRect(0,0,n.x,n.y);drawFigures(t,SCG.gameLogics.isPaused?[[new Vector2(n.x*.2,0),new Vector2(n.x*.8,n.y*.5),new Vector2(n.x*.2,n.y)]]:[[new Vector2(n.x*.2,0),new Vector2(n.x*.4,0),new Vector2(n.x*.4,n.y),new Vector2(n.x*.2,n.y)],[new Vector2(n.x*.6,0),new Vector2(n.x*.8,0),new Vector2(n.x*.8,n.y),new Vector2(n.x*.6,n.y)]],{alpha:this.transparency,fill:"darkgrey"})}});i.position=new Vector2(n.width-t.size.x-i.size.x/2,n.height-i.size.y/2);u.ui.push(i);SCG.audio&&(r=SCG.GO.create("button",{position:new Vector2,transparency:.75,handlers:{click:function(){return SCG.audio.muteToggle(),SCG.UI.invalidate(),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size,t=this.innerCanvasContext;t.clearRect(0,0,n.x,n.y);drawFigures(t,SCG.audio.mute?[[new Vector2(n.x*.1,n.y*.3),new Vector2(n.x*.3,n.y*.3),new Vector2(n.x*.5,0),new Vector2(n.x*.5,n.y),new Vector2(n.x*.3,n.y*.7),new Vector2(n.x*.1,n.y*.7)]]:[[new Vector2(n.x*.1,n.y*.3),new Vector2(n.x*.3,n.y*.3),new Vector2(n.x*.5,0),new Vector2(n.x*.5,n.y),new Vector2(n.x*.3,n.y*.7),new Vector2(n.x*.1,n.y*.7)],[new Vector2(n.x*.55,n.y*.4),new Vector2(n.x*.65,n.y*.4),new Vector2(n.x*.65,n.y*.6),new Vector2(n.x*.55,n.y*.6)],[new Vector2(n.x*.75,n.y*.2),new Vector2(n.x*.85,n.y*.2),new Vector2(n.x*.85,n.y*.8),new Vector2(n.x*.75,n.y*.8)]],{alpha:this.transparency,fill:"darkgrey"})}}),r.position=new Vector2(n.width-t.size.x-i.size.x-r.size.x/2,n.height-r.size.y/2),u.ui.push(r))},initialize:function(){if(!this.initialized)for(var n=0;n<this.controls.length;n++)SCG.GO.register(this.controls[n].type,this.controls[n])},helpers:{createCanvas:function(n){n.innerCanvas=document.createElement("canvas");var t=n.innerCanvas;t.width=n.size.x;t.height=n.size.y;n.innerCanvasContext=t.getContext("2d");n.img=n.innerCanvas}}};SCG.UI.controls=[{type:"button",size:new Vector2(50,50),contextName:"contextUI",innerCanvas:undefined,transparency:1,static:!0,text:undefined,useInnerCanvas:!0,border:!1,initializer:function(n){var i,t,r,u;if(this.useInnerCanvas&&(SCG.UI.helpers.createCanvas(n),i=n.innerCanvasContext,t=this.text,t!=undefined)){if(r=0,t.autoSize){u=300;do u--,i.font=u+"px "+t.font,r=i.measureText(t.value).width;while(r>this.size.x*.8)}else i.font=t.font,r=i.measureText(t.value).width;t.color&&(i.fillStyle=t.color);i.fillText(t.value,this.size.x/2-r/2,this.size.y/2+u/2);i.rect(1,1,this.size.x-1,this.size.y-1);i.stroke()}},internalRender:function(){if(this.border){var t=this.renderPosition,n=this.renderSize;this.context.rect(t.x-n.x/2,t.y-n.y/2,n.x,n.y);this.context.stroke()}}},{type:"label",size:new V2(50,10),innerCanvas:undefined,contextName:"contextUI",static:!0,text:{value:"sample",format:undefined,font:"px Arial",size:20,color:"black",border:!1,align:"center"},initializer:function(n){SCG.UI.helpers.createCanvas(n)},internalUpdate:function(){var t=this.innerCanvasContext,r=this.size,n=this.text,i;t.clearRect(0,0,r.x,r.y);t.font=n.size+n.font;t.fillStyle=n.color;i=n.value;n.format&&(i=String.format(n.format,n.value));t.textAlign=n.align;t.textBaseline="middle";t.fillText(i,this.size.x/2,this.size.y/2);n.border&&(t.rect(1,1,this.size.x-1,this.size.y-1),t.stroke())}},{type:"image",contextName:"contextUI",size:new V2(50,50),static:!0}];SCG.UI.initialize();SCG.audio={pause:!1,initialized:!1,mute:!1,players:[],notes:{dur:{_1:1,_2:.5,_4:.25,_8:.125,_16:.0625,_32:.03125},pause:0},init:function(){var i,n,t;if(!this.initialized){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;this.context=new AudioContext}catch(r){alert("Web Audio API is not supported in this browser")}for(i=["c","c_sh","d","d_sh","e","f","f_sh","g","g_sh","a","a_sh","h"],n=0;n<9;n++)for(this.notes["o"+n]={},t=0;t<12;t++)this.notes["o"+n][i[t]]=440*Math.pow(2,((n-4)*12+(t-9))/12);this.initialized=!0}},playPause:function(n){this.connectToggle(n)},muteToggle:function(){this.mute=!this.mute;this.connectToggle(this.mute)},connectToggle:function(n){for(var t=0;t<this.players.length;t++)this.players[t].connectToggle(n)},update:function(n){for(var t=this.players.length,i;t--;)i=this.players[t],i.update(n),i.isAlive||this.players.splice(t,1)},start:function(n){this.initialized||this.init();n.context=this.context;n.mute=this.mute;this.players.push(new SCG.audio.Player(n))}};SCG.audio.init();SCG.audio.Player=function(n){if(this.loop=!1,this.notes=[],this.noteIndex=-1,this.curVol=0,this.maxVol=.05,this.context=undefined,this.gainNodes=[],this.currentNote=undefined,this.isAlive=!0,this.length=1e3,this.type="triangle",this.notesChangeTimer={ignorePause:!0,lastTimeWork:new Date,delta:0,currentDelay:0,originDelay:0,doWorkInternal:undefined,context:undefined},n==undefined)throw"SCG.audio.Player -> props are undefined";extend(!0,this,n);this.notesChangeTimer.doWorkInternal=this.noteChange;this.notesChangeTimer.context=this;this.curVol=this.maxVol;this.noteIndex=-1;this.noteChange()};SCG.audio.Player.prototype={constructor:SCG.audio.Player,update:function(n){this.isAlive&&doWorkByTimer(this.notesChangeTimer,n)},noteChange:function(){if(this.isAlive){if(this.noteIndex++,this.noteIndex>=this.notes.length)if(this.loop)this.noteIndex=0;else{this.isAlive=!1;return}this.setValues(this.notes[this.noteIndex])}},setValues:function(n){var r=[],f,u,i,t;for(this.gainNodes=[],isArray(n.value)?r=n.value:r.push(n.value),f=n.duration*this.length,u=0;u<r.length;u++)r[u]!=0&&(i=this.context.createOscillator(),t=this.context.createGain(),this.mute||(i.connect(t),t.connect(this.context.destination)),i.type=this.type,t.gain.value=this.maxVol,t.gain.setValueAtTime(this.curVol,this.context.currentTime),t.gain.exponentialRampToValueAtTime(.0001,this.context.currentTime+f*3/1e3),i.frequency.value=r[u],this.gainNodes.push(t),i.start(0),i.stop(this.context.currentTime+n.duration*4),i.onended=function(){t.disconnect()});this.notesChangeTimer.originDelay=f;this.notesChangeTimer.currentDelay=f},connectToggle:function(n){this.mute=n;for(var t=0;t<this.gainNodes.length;t++)n?this.gainNodes[t].disconnect(this.context.destination):this.gainNodes[t].connect(this.context.destination)}};SCG.start=function(){SCG.canvasBg||(SCG.canvasBg=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasBgId,css:{"z-index":0,position:"absolute"}}),SCG.contextBg=SCG.canvasBg.getContext("2d"),SCG.contexts.contextBg=SCG.contextBg);SCG.canvas||(SCG.canvas=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasId,css:{"z-index":1,position:"absolute"}}),SCG.context=SCG.canvas.getContext("2d"),SCG.contexts.context=SCG.context);SCG.canvasUI||(SCG.canvasUI=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasUIId,css:{"z-index":2,position:"absolute"}}),SCG.contextUI=SCG.canvasUI.getContext("2d"),SCG.contexts.contextUI=SCG.contextUI);SCG.initializer(function(){SCG.space==undefined&&(SCG.space={width:SCG.viewfield.default.width,height:SCG.viewfield.default.height});SCG.viewfield.current=new Box(new Vector2,new Vector2(SCG.viewfield.width,SCG.viewfield.height));SCG.customInitialization();SCG.gameControls.orientationChangeEventInit();SCG.UI.invalidate();SCG.audio&&SCG.audio.init();SCG.animate()})};SCG.preMainWork=function(){};SCG.afterMainWork=function(){};SCG.animate=function(){SCG.draw();requestAnimationFrame(SCG.animate)};SCG.draw=function(){var i,n,r,t,u;if(SCG.scenes.activeScene==undefined||SCG.scenes.activeScene.go==undefined)throw"Active scene corrupted!";if(i=new Date,SCG.gameLogics.doPauseWork(i),n=SCG.scenes.activeScene,n.preMainWork&&isFunction(n.preMainWork)&&n.preMainWork(),SCG.gameControls.camera.update(i),n.unshift.length>0){for(r=0;r<n.unshift.length;r++)n.go.unshift(n.unshift[r]);n.unshift=[]}for(t=n.go.length;t--;)n.go[t].update(i),n.go[t].render(),SCG.frameCounter&&n.go[t].renderPosition!=undefined&&SCG.frameCounter.visibleCount++,n.go[t].alive||(u=n.go.splice(t,1));n.afterMainWork&&isFunction(n.afterMainWork)&&n.afterMainWork();SCG.gameLogics.isPausedStep&&(SCG.gameLogics.isPausedStep=!1);SCG.frameCounter&&SCG.frameCounter.doWork(i);SCG.audio&&SCG.audio.update(i)};document.addEventListener("DOMContentLoaded",function(){var n;SCG.src={};n=SCG.globals;n.items=[];n.bgRender=function(n){var r="gray",t,i;n&&n.color&&(r=n.color);t=SCG.contextBg;i=SCG.viewfield;t.beginPath();t.rect(0,0,i.width,i.height);t.fillStyle=r;t.fill()};n.clearBg=function(){SCG.context.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height)};n.modalClose=function(t,i,r){t.ui.push(n.cb({position:new V2(i.width*.95,i.height*.05),size:new V2(50,30),text:{value:"Close",color:"red",autoSize:!0,font:"Arial"},handlers:{click:function(){return r(),{preventBubbling:!0}}}}))};n.create=function(n,t){return SCG.GO.create(n,t)};n.cl=function(t){return n.create("label",t)};n.cfo=function(t){return n.create("fadingObject",t)};n.cb=function(t){return n.create("button",t)};n.unitTypes=["Fighter","Defender","Ranged"];n.itemTypes=["weapon","shield","helmet","armor"];n.materialTypes=["bronze","steel","mithril"];n.attributes=["str","agl","con"];var i={name:"demo_s1",space:{width:500,height:300},dispose:function(){for(var n=0;n<this.game.intervals.length;n++)clearInterval(this.game.intervals[n])},start:function(t){var i=this.game,f,r,u;i.AI.initialize(t.level);i.level=t.level;f=this;i.intervals.push(setInterval(function(){SCG.AI.sendEvent({type:"units",message:f.go.filter(function(n){return n.toPlain}).map(function(n){return n.toPlain()})})},200));t.fromManagement&&(this.go=t.gos,i.money=t.money);this.go.filter(function(n){return n.side==1}).forEach(function(n){n.regClick();n.selected=!1});r=new V2(100,20);u=n.cl({position:new V2(100,10),size:r,text:{size:10,value:i.money,color:"gold",format:"Money: {0}"}});i.labels.money=u;this.ui.push(u);this.ui.push(n.cl({position:new V2(200,10),size:r,text:{size:10,value:i.level,color:"orange",format:"Wave level: {0}"}}));SCG.UI.invalidate()},backgroundRender:function(){n.bgRender()},preMainWork:function(){n.clearBg()},game:{money:0,level:1,playerUnit:undefined,labels:{money:undefined},clickHandler:function(t){var i=this.playerUnit,u,r,h,f,e,o,s,c,l;if(i){u=t.add(SCG.viewfield.current.topLeft);i.setDestination(u);r=new V2(Math.abs(i.position.x-u.x),Math.abs(i.position.y-u.y));h=i.position.x<=u.x?0:1;u.y<i.position.y&&(h+=2);f=document.createElement("canvas");f.width=r.x;f.height=r.y;switch(h){case 0:e=new V2(i.size.x/2,0);o=new V2(0,i.size.y/2);s=new V2(r.x,r.y);break;case 1:e=new V2(r.x-i.size.x/2,0);o=new V2(r.x,i.size.y/2);s=new V2(0,r.y);break;case 2:e=new V2(0,r.y-i.size.y/2);o=new V2(i.size.x/2,r.y);s=new V2(r.x,0);break;case 3:e=new V2(r.x-i.size.x/2,r.y);o=new V2(r.x,r.y-i.size.y/2);s=new V2(0,0)}c=f.getContext("2d");drawFigures(c,[[e,o,s]],{alpha:1,fill:"blue"});l=i.position.add(i.position.direction(u).normalize().mul(i.position.distance(u)/2));SCG.scenes.activeScene.go.push(n.cfo({position:l,lifeTime:300,img:f,size:r}))}},intervals:[],AI:{initialize:function(n){SCG.AI.initializeEnvironment({space:{width:SCG.space.width,height:SCG.space.height},units:{ai:[],player:[],history:{}},level:n,waveProps:{created:0,max:n*5,atOnce:n+1}})},messagesProcesser:function(i){var r,f,e,s,u;if(i!=undefined&&i.command){r=SCG.scenes.activeScene;f=i.message;switch(i.command){case"move":for(u=undefined,e=0;e<r.go.length;e++)if(r.go[e].id==f.id){r.go[e].setDestination(new V2(f.position));break}break;case"gameOver":SCG.scenes.selectScene(o.name);break;case"waveEnd":r.unshift.push(n.cfo({position:new V2(r.space.width/2-150,r.space.height/2),lifeTime:5e3,text:{size:50,color:"RED",value:"BATTLE WIN"},size:new V2(r.space.width,r.space.height),shift:new V2(0,-.5)}));setTimeout(function(){SCG.scenes.selectScene(t.name,{money:r.game.money,fromBattle:!0,level:r.game.level+1,gos:r.go.filter(function(n){return n.side==1&&n.type=="unit"})})},5e3);break;case"create":for(s=n.unitTypes[f.type],u=SCG.GO.create("unit",{position:new V2(r.space.width-25,getRandomInt(25,r.space.height-25)),size:new V2(50,50),side:2,health:100,speed:.3,unitType:s,level:0});u.level<f.level;)u.levelUp();f.items.forEach(function(t,i){if(t){var e=r.game.level<4?0:r.game.level<8?1:2,f=n.items.filter(function(t){return t.itemType==n.itemTypes[i]&&t.unitTypes.indexOf(s)!=-1&&t.itemName.indexOf(n.materialTypes[e])!=-1});f.length>0&&u.addItem(SCG.GO.create("item",f[getRandomInt(0,f.length-1)]))}});u.expCost=30+10*u.level;u.cost=20+5*u.level;r.go.push(u)}}},queueProcesser:function(){for(var c,t,i,u,l,n,e,o;queue.length;){c=queue.pop();switch(c.type){case"start":self.helpers={move:function(n,t){self.postMessage({command:"move",message:{id:n,position:t}})},create:function(n,t,i){self.postMessage({command:"create",message:{type:t,level:n,items:i}})},end:function(n){self.postMessage({command:n?"gameOver":"waveEnd",message:{}})}};break;case"units":if(t=self.environment,i=t.units,t.waveProps.end)return;for(n=1;n<3;n++)i[n==1?"player":"ai"]=c.message.filter(function(t){return t.side==n}).map(function(n){return n.position=new V2(n.position),n});if(u=self.helpers,i.player.length==0&&u.end(!0),u==undefined||i.player.length==0)return;if(t.waveProps.created<t.waveProps.max){if(t.waveProps.atOnce>i.ai.length){var w=getRandomInt(t.level==1?0:t.level,t.level*2),b=getRandomInt(0,2),a=[];for(n=0;n<4;n++)a[n]=Math.random()>1-t.level/10;u.create(w,b,a);t.waveProps.created++}}else i.ai.length==0&&(t.waveProps.end=!0,u.end());for(l=[],n=0;n<i.ai.length;n++){var r=i.ai[n],f=i.player.map(function(n){return{distance:r.position.distance(n.position),unit:n}}),s=f[0];if(f.length>1)for(e=1;e<f.length;e++)f[e].distance<s.distance&&(s=f[e]);if(s.distance>r.range){var v=s.unit.position,y=r.position.direction(v).mul(-1),p=y,h=undefined;for(o=0;o<20;o++){if(h=v.add(p.mul(.8*r.range)),l.filter(function(n){return boxIntersectsBox({center:h,size:r.size},{center:n.dest,size:n.unit.size})}).length==0)break;p=y.rotate((Math.floor(o/2)+1)*10*(o%2==0?1:-1),!1,!1)}l.push({dest:h,unit:r});u.move(r.id,h)}}}}}}},gameObjectsBaseProperties:[{type:"unit",size:new V2(20,20),speed:1,imgPropertyName:"unit",jumpOptions:{current:-1,start:-1,end:1,step:.1},items:{weapon:undefined,armor:undefined,helmet:undefined,shield:undefined},level:1,experience:0,side:1,health:100,canAttack:!0,defence:1,damage:{min:2,max:5,crit:1},attackRadius:20,attackRate:500,unitType:"Fighter",stats:{str:0,agl:0,dex:0,con:0},initializer:function(n){n.attackRadius=n.size.x;n.attackDelayTimer={lastTimeWork:new Date,delta:0,currentDelay:0,originDelay:0,doWorkInternal:n.canAttackToggle,context:n};n.destSourcePosition=new V2((n.side-1)*50,0);var t=n.stats;switch(n.unitType){case"Fighter":t.str=2;t.con=1;break;case"Defender":t.agl=2;t.con=1;break;case"Ranged":t.con=2;t.str=1;t.agl=1;break;default:throw"Unknown unit type";}Object.keys(n.items).forEach(function(t){n.items[t]&&(n.items[t]=SCG.GO.create("item",SCG.globals.items.filter(function(i){return i.itemName==n.items[t]})[0]))})},handlers:{click:function(){var n,t;if(this.side==1){for(n=SCG.scenes.activeScene,t=0;t<n.go.length;t++)n.go[t].selected=!1;this.selected=!0;n.name=="management"?n.game.unitSelected(this):(n.game.playerUnit=this,SCG.gameControls.camera.center(n.game.playerUnit))}return{preventBubbling:!0}}},levelUp:function(n){n==undefined&&(n=SCG.globals.attributes[getRandomInt(0,2)]);this.stats[n]++;this.level++},getStats:function(n){var i=this.items,t=i.weapon,r;switch(n){case"attackRadius":return this.attackRadius+(t?t.attackRadius:0);case"damage":return r=1+.2*this.stats.str,{min:parseFloat(((this.damage.min+(t?t.damage.min:0))*r).toFixed(1)),max:parseFloat(((this.damage.max+(t?t.damage.max:0))*r).toFixed(1)),crit:t?t.damage.crit:this.damage.crit};case"defence":return parseFloat(((this.defence+(i.armor?i.armor.defence:0)+(i.helmet?i.helmet.defence:0)+(i.shield?i.shield.defence:0))*(1+.2*this.stats.agl)).toFixed(1));case"attackRate":return t?t.attackRate:this.attackRate;case"health":return this.health+this.stats.con*20;case"ranged":return t&&t.ranged?t.ranged:!1;case"expCap":return Math.pow(this.level,2)*100}},toPlain:function(){var n=this;return{id:n.id,position:n.position,health:n.getStats("health"),damage:n.getStats("damage"),side:n.side,range:n.getStats("attackRadius"),size:n.size}},toSave:function(){var n=this;return{side:n.side,size:n.size,speed:n.speed,level:n.level,experience:n.experience,unitType:n.unitType,stats:n.stats,items:{weapon:n.items.weapon?n.items.weapon.toSave():undefined,armor:n.items.armor?n.items.armor.toSave():undefined,helmet:n.items.helmet?n.items.helmet.toSave():undefined,shield:n.items.shield?n.items.shield.toSave():undefined}}},canAttackToggle:function(){this.canAttack=!this.canAttack;this.attackDelayTimer.lastTimeWork=new Date;this.attackDelayTimer.currentDelay=this.getStats("attackRate")},receiveAttack:function(t,i){var u=this.getStats("defence"),r;(t-=u,t<=0&&(t=Math.random()<(1/((u-t)*1.5)?t/3:0),t<=0))||(t=parseFloat(t.toFixed(1)),r=SCG.scenes.activeScene,r.unshift.push(n.cfo({position:this.position.clone(),lifeTime:1e3,text:{size:12,color:"#ff2400",value:t},size:new V2(10,10),shift:new V2(.15,-.5)})),this.health-=t,this.getStats("health")<=0&&(this.side==2&&(i.experience+=this.expCost,r.game.money+=this.cost,r.game.labels.money.text.value=r.game.money,SCG.UI.invalidate()),this.setDead()))},beforeDead:function(){SCG.scenes.activeScene.go.push(n.cfo({position:this.position.clone(),imgPropertyName:"actions",destSourcePosition:new V2(250,0),size:new V2(50,50),lifeTime:5e3}))},addItem:function(n){if(this.items[n.itemType]=n,n.itemType=="weapon"){var t=this.getStats("attackRate");this.attackDelayTimer.currentDelay=t;this.attackDelayTimer.originDelay=t}},attack:function(t){var o=this.position.substract(t.position),r=0,i,e;o.x>0&&(r=2);o.y<0&&r++;var s=SCG.scenes.activeScene,u=this.getStats("damage"),h=getRandom(u.min,u.max)*(Math.random()<u.crit/100?3:1);if(this.getStats("ranged")){var l=this.position.direction(t.position),c=this.position.distance(t.position),f=[];for(i=0;i<10;i++)e=this.position.add(l.mul(c/10*(i+1))),e.y-=(-.04*Math.pow(i-5,2)+1)*c/5,f.push(e);s.unshift.push(SCG.GO.create("projectile",{position:f.shift(),path:f,side:this.side,sender:this,damage:h}))}else s.unshift.push(n.cfo({position:this.position.clone(),imgPropertyName:"actions",destSourcePosition:new V2(r*50,0),size:new V2(50,50)})),SCG.audio.start({notes:[{value:200,duration:.7}],loop:!1}),SCG.audio.start({notes:[{value:1e3,duration:.3}],loop:!1}),t.receiveAttack(h,this);this.canAttackToggle()},internalUpdate:function(n){var f=this,r,u,i,t;if(Object.keys(this.items).forEach(function(n){f.items[n].update()}),this.canAttack){for(r=SCG.scenes.activeScene,u=r.go.length;u--;)if(i=r.go[u],i.type=="unit"&&i.side!=this.side&&this.position.distance(i.position)<this.getStats("attackRadius")){this.attack(i);break}}else doWorkByTimer(this.attackDelayTimer,n);if(t=this.jumpOptions,this.renderPosition&&(this.destination||t.current!=-1&&t.current<=t.end))this.renderPosition.y-=(-1*Math.pow(t.current,2)+1)*10;else return;t.current+=t.step;t.current>t.end&&(t.current=t.start)},internalRender:function(){var t=this,i=t.context,r=t.renderPosition,n,u;i.translate(r.x,r.y);t=t;Object.keys(t.items).sort().forEach(function(n){t.items[n].render()});n=t.renderSize;t.selected&&i.drawImage(SCG.images.actions,200,0,50,50,0-n.x/2,0-n.y/2,n.x,n.y);u=n.y/4;i.font=u+"px Arial";i.fillStyle="blue";i.fillText(t.unitType.substring(0,1)+t.level,n.x/3,-n.y/4);var e=100+t.stats.con*20,o=t.getStats("health"),f=t.getStats("health")/(100+t.stats.con*20);i.fillStyle="red";i.fillRect(-n.x/2,-n.y/2,n.x*.8,n.y/10);i.fillStyle="green";i.fillRect(-n.x/2,-n.y/2,n.x*.8*f,n.y/10);i.translate(-r.x,-r.y)}},{type:"line",size:new V2(1,1),isCustomRender:!0,customRender:function(){var n=SCG.context,t=this.renderSize;n.beginPath();n.rect(this.renderPosition.x-t.x/2,this.renderPosition.y-t.y/2,t.x,t.y);n.fillStyle="red";n.fill()}},{type:"projectile",damage:1,path:[],speed:5,destSourcePosition:new V2(60,250),imgPropertyName:"items",size:new V2(10,25),setDeadOnDestinationComplete:!0,angle:0,beforeDead:function(){for(var r=SCG.scenes.activeScene,t=this,i=r.go.filter(function(n){return n.type=="unit"&&n.side&&n.side!=t.side&&n.box.isPointInside(t.position)}),n=0;n<i.length;n++)i[n].receiveAttack(this.damage,this.sender)},internalPreRender:function(){var t=SCG.context,n=this.renderPosition,i=this.direction;t.translate(n.x,n.y);i&&!i.equal(new V2)&&(this.angle=V2.up().angleTo(i,!0),t.rotate(this.angle));t.translate(-n.x,-n.y)},internalRender:function(){var t=SCG.context,n=this.renderPosition;t.translate(n.x,n.y);t.rotate(-this.angle);t.translate(-n.x,-n.y)}},{type:"fadingObject",lifeTime:500,alpha:1,shift:undefined,text:undefined,initializer:function(n){n.text&&(n.isCustomRender=!0)},internalPreRender:function(){SCG.context.save();SCG.context.globalAlpha=this.alpha},internalRender:function(){SCG.context.restore()},customRender:function(){var t=SCG.context,n=this.text;t.font=n.renderSize+"px Arial";n.color&&(t.fillStyle=n.color);t.fillText(n.value,this.renderPosition.x,this.renderPosition.y)},internalUpdate:function(n){this.alpha=1-(n-this.creationTime)/this.lifeTime;this.alpha<=0&&(this.alive=!1);this.shift!=undefined&&this.position.add(this.shift,!0);this.text&&(this.text.renderSize=this.text.size*SCG.gameControls.scale.times)}},{type:"item",size:new V2(10,50),imgPropertyName:"items",static:!0,toSave:function(){return this.itemName}}]},t={name:"management",space:{width:500,height:300},dispose:function(){},start:function(t){var l=this.game.selectedUnit.statsControls,e,u,v,o,s,h,c,a;if(l.initialized||l.initialize(),e=this,u=this.game,t.fromBattle?(this.go=t.gos,this.game.money=t.money,t.level&&(this.game.level=t.level)):t.fromUTSelect&&t.type&&u.updateMoney(50)&&this.go.push(SCG.GO.create("unit",{position:new V2,size:new V2(50,50),health:100,unitType:t.type})),v=undefined,this.go.forEach(function(n,i){n.position=new V2(n.size.x/2,n.size.y/2+i*50);n.destination=undefined;n.health=100;t.fromItemSelect||t.fromLevelUp||(n.selected=!1);n.regClick()}),this.go.length<6)for(o=this.go.length;o<7;o++)(function(t){e.ui.push(n.cb({position:new V2(25,25+t*50),text:{value:"HIRE 50",autoSize:!0,font:"Arial",color:"gold"},handlers:{click:function(){return SCG.scenes.selectScene(r.name),{preventBubbling:!0}}}}))})(o);s=u.selectedUnit.statsControls.labels;Object.keys(s).forEach(function(n){e.ui.push(s[n])});h=u.selectedUnit.statsControls.buttons;Object.keys(h).forEach(function(n){e.ui.push(h[n])});c=n.cl({position:new V2(100,10),size:new V2(100,20),text:{size:10,value:u.money,color:"gold",format:"Money: {0}"}});u.labels.money=c;this.ui.push(c);this.ui.push(n.cl({position:new V2(200,10),size:new V2(100,20),text:{size:10,value:u.level,color:"orange",format:"Wave level: {0}"}}));e.ui.push(SCG.GO.create("image",{position:new V2(230,220),size:new V2(150,150),destSourcePosition:new V2(0,0),destSourceSize:new V2(50,50),imgPropertyName:"unit"}));e.ui.push(n.cb({position:new V2(this.space.width-130,50),size:new V2(70,40),text:{value:"Play",autoSize:!0,font:"Arial"},handlers:{click:function(){if(e.go.length==0){alert("You have no units to play!\nHire someone.");return}if(e.go.filter(function(n){return n.experience>=n.getStats("expCap")}).length>0){alert("One of your units need level up!");return}var n={money:u.money,level:u.level,gos:e.go.map(function(n){return n.toSave()})};return SCG.gameControls.storage.save("rpg_0",n),SCG.scenes.selectScene(i.name,{fromManagement:!0,gos:e.go,level:u.level,money:u.money}),{preventBubbling:!0}}}}));e.ui.push(n.cb({position:new V2(this.space.width-130,90),size:new V2(70,40),text:{value:"Level up",autoSize:!0,font:"Arial"},handlers:{click:function(){var n=SCG.scenes.activeScene.game.selectedUnit.unit;if(!SCG.scenes.activeScene.game.selectedUnit.unit){alert("No selected unit");return}if(n.experience<n.getStats("expCap")){alert("Level up is unavailable");return}return SCG.scenes.selectScene(f.name),{preventBubbling:!0}}}}));t.fromItemSelect?(a=u.selectedUnit.unit,t.item&&u.updateMoney(t.item.price)&&a.addItem(SCG.GO.create("item",t.item)),u.unitSelected(u.selectedUnit.unit)):t.fromLevelUp?(t.attr&&u.selectedUnit.unit.levelUp(t.attr),u.unitSelected(u.selectedUnit.unit)):u.selectedUnit.unit=undefined;SCG.UI.invalidate()},backgroundRender:function(){n.bgRender()},preMainWork:function(){n.clearBg()},game:{money:0,level:1,setMoney:function(n){this.money=n;this.labels.money.text.value=this.money},updateMoney:function(n){var t=this.money>n;return t?this.setMoney(this.money-n):alert("Not enought money!"),t},labels:{money:undefined},selectedUnit:{unit:undefined,statsControls:{initialized:!1,initialize:function(){var t=this;[{n:"hp",p:new V2(110,50),color:"Red",f:"Health: {0}"},{n:"str",p:new V2(110,70),f:"Strenght: {0}"},{n:"agl",p:new V2(110,90),f:"Agility: {0}"},{n:"con",p:new V2(110,110),f:"Constitution: {0}"},{n:"rte",p:new V2(110,130),s:200,f:"Attack rate: {0}"},{n:"lvl",p:new V2(250,50),color:"Blue",f:"Level: {0}"},{n:"exp",p:new V2(250,70),s:200,f:"Experience: {0}"},{n:"atk",p:new V2(250,90),s:200,f:"Attack: {0}"},{n:"def",p:new V2(250,110),f:"Defence: {0}"},{n:"rng",p:new V2(250,130),f:"Range: {0}"}].forEach(function(i){t.labels[i.n]=n.cl({position:i.p,size:new V2(i.s?i.s:100,30),text:{size:15,color:i.color?i.color:"Black",value:0,format:i.f}})});[{n:"wpn",p:new V2(170,220),s:new V2(40,120),it:"weapon"},{n:"shd",p:new V2(295,220),s:new V2(50,120),it:"shield"},{n:"hlm",p:new V2(230,185),s:new V2(80,50),it:"helmet"},{n:"arm",p:new V2(230,235),s:new V2(80,50),it:"armor"}].forEach(function(i){t.buttons[i.n]=n.cb({position:i.p,size:i.s,border:!0,useInnerCanvas:!1,handlers:{click:function(){var n=SCG.scenes.activeScene.game.selectedUnit.unit,t;return n?(t=n.items[i.it],SCG.scenes.selectScene(u.name,{unitType:n.unitType,itemType:i.it,equippedItem:t?t.itemName:""})):alert("No selected unit"),{preventBubbling:!0}}}})})},labels:{},buttons:{}}},unitSelected:function(n){var i,r,t;this.selectedUnit.unit=n;i=this.selectedUnit.statsControls.labels;i.hp.text.value=n.getStats("health");i.str.text.value=n.stats.str;i.agl.text.value=n.stats.agl;i.con.text.value=n.stats.con;i.lvl.text.value=n.level;i.exp.text.value=String.format("{0}-{1}",n.experience,n.getStats("expCap"));i.exp.text.color=n.experience>=n.getStats("expCap")?"green":"black";r=n.getStats("damage");i.atk.text.value=String.format("{0}-{1}({2}%)",r.min,r.max,r.crit);i.def.text.value=n.getStats("defence");i.rng.text.value=n.getStats("attackRadius");i.rte.text.value=n.getStats("attackRate");t=this.selectedUnit.statsControls.buttons;n.items.weapon?(t.wpn.img=n.items.weapon.img,t.wpn.destSourcePosition=n.items.weapon.destSourcePosition,t.wpn.destSourceSize=n.items.weapon.size):t.wpn.img=undefined;n.items.shield?(t.shd.img=n.items.shield.img,t.shd.destSourcePosition=n.items.shield.destSourcePosition,t.shd.destSourceSize=n.items.shield.size):t.shd.img=undefined;n.items.helmet?(t.hlm.img=n.items.helmet.img,t.hlm.destSourcePosition=n.items.helmet.destSourcePosition,t.hlm.destSourceSize=n.items.helmet.size):t.hlm.img=undefined;n.items.armor?(t.arm.img=n.items.armor.img,t.arm.destSourcePosition=n.items.armor.destSourcePosition,t.arm.destSourceSize=n.items.armor.size):t.arm.img=undefined;SCG.UI.invalidate()}}},r={name:"ut_select",space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},start:function(){var e=this,i=this.space,o=new V2(i.width*.1,i.height*.15),u,r,f;SCG.globals.modalClose(e,i,function(){SCG.scenes.selectScene(t.name,{fromUTSelect:!0,type:undefined})});u=SCG.globals.unitTypes;r=new V2(i.width*.8/u.length,i.height*.7);u.forEach(function(i,u){e.ui.push(n.cb({position:new V2(o.x+r.x/2+r.x*u,o.y+r.y/2),size:r,text:{value:i,autoSize:!0,font:"Arial"},handlers:{click:function(){return SCG.scenes.selectScene(t.name,{fromUTSelect:!0,type:i}),{preventBubbling:!0}}}}))});f=SCG.viewfield;SCG.context.clearRect(0,0,f.width,f.height);SCG.UI.invalidate()},preMainWork:function(){n.clearBg()},backgroundRender:function(){n.bgRender()}},u={name:"item_select",space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},start:function(n){var r=this,f=this.space,i=new V2(f.width*.8/3,f.height*.7/3),o=new V2(f.width*.1,f.height*.15),u=SCG.globals,e;u.modalClose(r,f,function(){SCG.scenes.selectScene(t.name,{fromItemSelect:!0,item:undefined})});u.items.filter(function(t){return t.itemType==n.itemType&&t.unitTypes.indexOf(n.unitType)!=-1&&t.itemName!=n.equippedItem}).forEach(function(n,f){var c=parseInt(f/3),a=f-c*3,h=new V2(o.x+i.x/2+i.x*a,o.y+i.y/2+i.y*c);r.ui.push(u.cb({position:h,size:i,text:{value:"",autoSize:!0,font:"Arial"},handlers:{click:function(){return SCG.scenes.selectScene(t.name,{fromItemSelect:!0,item:n}),{preventBubbling:!0}}}}));var l=n.size.mul(i.y/n.size.y),v=h.substract(new V2(i.x/2-l.x/2-i.x*.05),0),s=h.substract(new V2(-15,i.y/2)),e=new V2(100,i.y/4);r.ui.push(SCG.GO.create("image",{position:v,size:l,destSourcePosition:n.destSourcePosition,destSourceSize:n.size,imgPropertyName:"items"}));r.ui.push(u.cl({position:s.add(new V2(0,e.y/2)),size:e,text:{color:"Red",value:n.price,format:"Price: {0}"}}));switch(n.itemType){case"weapon":r.ui.push(u.cl({position:s.add(new V2(0,1.5*e.y)),size:e,text:{size:10,value:String.format("Damage {0}-{1}({2}%)",n.damage.min,n.damage.max,n.damage.crit)}}));r.ui.push(u.cl({position:s.add(new V2(0,2.5*e.y)),size:e,text:{size:10,value:n.attackRate,format:"Rate: {0}"}}));r.ui.push(u.cl({position:s.add(new V2(0,3.5*e.y)),size:e,text:{size:10,value:n.attackRadius,format:"Range: {0}"}}));break;case"shield":case"armor":case"helmet":r.ui.push(u.cl({position:s.add(new V2(0,1.5*e.y)),size:e,text:{size:10,value:n.defence,format:"Defence: {0}"}}))}});e=SCG.viewfield;SCG.context.clearRect(0,0,e.width,e.height);SCG.UI.invalidate()},preMainWork:function(){n.clearBg()},backgroundRender:function(){n.bgRender()}},f={name:"level_up",space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},start:function(){var u=this,i=this.space,e=new V2(i.width*.1,i.height*.15),r=SCG.globals,f;r.modalClose(u,i,function(){SCG.scenes.selectScene(t.name,{fromLevelUp:!0,attr:undefined})});var n=new V2(i.width*.8/3,i.height*.7),o="",s="";r.attributes.forEach(function(i,f){var h=new V2(e.x+n.x/2+n.x*f,e.y+n.y/2);o=f==0?"Strenght":f==1?"Agility":"Constitution";s=f==0?"Increase damage by 20%":f==1?"Increase defence by 20%":"Increase health by 20";u.ui.push(r.cl({position:h.substract(new V2(0,20)),size:n,text:{size:20,value:o}}));u.ui.push(r.cl({position:h.substract(new V2(0,-20)),size:n,text:{size:10,value:s}}));u.ui.push(r.cb({position:h,size:n,text:{value:"",autoSize:!0,font:"Arial"},handlers:{click:function(){return SCG.scenes.selectScene(t.name,{fromLevelUp:!0,attr:i}),{preventBubbling:!0}}}}))});f=SCG.viewfield;SCG.context.clearRect(0,0,f.width,f.height);SCG.UI.invalidate()},preMainWork:function(){n.clearBg()},backgroundRender:function(){n.bgRender()}},e={name:"new_game",space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},dispose:function(){for(var n=0;n<this.game.intervals.length;n++)clearInterval(this.game.intervals[n])},start:function(){var i=this;[{name:"New game",py:100,click:function(){SCG.scenes.selectScene(s.name)}},{name:"Continue",py:150,click:function(){var n=SCG.gameControls.storage.load("rpg_0"),i;n&&(i=n.gos.map(function(n){return n.size=new V2(n.size),SCG.GO.create("unit",n)}),SCG.scenes.activeScene.go=[],SCG.scenes.selectScene(t.name,{fromBattle:!0,level:n.level,gos:i,money:n.money}))}}].forEach(function(t){i.ui.push(n.cb({position:new V2(250,t.py),size:new V2(180,40),text:{value:t.name,autoSize:!0,color:"white",font:"Arial"},handlers:{click:function(){return t.click(),{preventBubbling:!0}}}}))});this.game.showTitle(this);this.game.intervals.push(setInterval(function(){i.game.showTitle(i)},2e3));this.ui.push(n.cl({position:new V2(250,250),size:new V2(200,30),text:{size:10,value:"SCG production 2016",color:"white"}}))},game:{intervals:[],showTitle:function(t){t.unshift.push(n.cfo({position:new V2(120,50),lifeTime:2e3,text:{size:40,color:"gold",value:"Inevitable glitch"},size:new V2(200,60),shift:new V2(0,.05)}))}},preMainWork:function(){n.clearBg()},backgroundRender:function(){n.bgRender({color:"black"})}},o={name:"game_over",space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},start:function(){var t=this;["A problem has been detected and system has been shut down to prevent damage","to your device","","The problem seems to be caused by the following file: VIRUS.SYS","","If this is the first time you've seen this stop error screen,","it means you loose and game is over. If this screen appears again, follow","these steps:","","Try reload page and press continue to restore your progress, or press new game","to begin new game. Ask your hardware or software manufacturer for any system","updates you might need","","If problem continue, disable or remove any newly installed hardware","or software. Disable BIOS memory options such as caching or shadowing.","If you need to use safe mode ro remove or disable components, restart","your device, then do something to enter to safe mode.","","Technical information:","","*** STOP: 0x00000087 (0x20160913, 0x44312346, 0x05673245, 0x00000000)","","*** VIRUS.SYS - Have a nice day. Address: 0x2346123 base 0x633456"].forEach(function(i,r){t.ui.push(n.cl({position:new V2(10,(r+1)*12),size:new V2(1e3,12),text:{size:12,value:i,color:"white",align:"left"}}))});SCG.UI.invalidate()},preMainWork:function(){n.clearBg()},backgroundRender:function(){n.bgRender({color:"#000082"})}},s={name:"intro",space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},dispose:function(){for(var n=0;n<this.game.timeouts.length;n++)clearTimeout(this.game.timeouts[n])},start:function(){var n=this;["Usage of unlicensed software","not only violates the law","but it may harm your system","with the result that GLITCHES can come","or system will stop working completely","","Take on the role of the anti-malvare team","and save the system from infection","during the 10 attack waves","in style of simple RPG","","Have a nice play","$$$"].forEach(function(t,i){n.game.show(n,t,(i+1)*2e3)})},game:{timeouts:[],show:function(t,i,r){var u=this;this.timeouts.push(setTimeout(function(){i=="$$$"?u.clickHandler():t.unshift.push(n.cfo({position:new V2(120,150),lifeTime:5e3,text:{size:20,color:"white",value:i},size:new V2(200,60),shift:new V2(0,-.25)}))},r))},clickHandler:function(){SCG.scenes.selectScene(t.name,{money:200,level:1,fromBattle:!0,gos:[]})}},preMainWork:function(){n.clearBg()},backgroundRender:function(){n.bgRender({color:"Black"})}};SCG.customInitializaers.push(function(){var l=document.createElement("canvas"),s,n,a,h,r,i,c,e;for(l.width=100,l.height=50,s=l.getContext("2d"),n=0,a=0;a<2;a++)drawFigures(s,[[new V2(20+n,11.5),new V2(30+n,11.5),{type:"curve",control:new V2(40+n,10),p:new V2(38.5+n,20)},new V2(38.5+n,30),{type:"curve",control:new V2(40+n,40),p:new V2(30+n,38.5)},new V2(20+n,38.5),{type:"curve",control:new V2(10+n,40),p:new V2(11.5+n,30)},new V2(11.5+n,20),{type:"curve",control:new V2(10+n,10),p:new V2(20+n,11.5)}],[new V2(1+n,20),new V2(10+n,20),new V2(10+n,30),new V2(1+n,30),new V2(1+n,20)],[new V2(40+n,20),new V2(49+n,20),new V2(49+n,30),new V2(40+n,30),new V2(40+n,20)]],{alpha:1,fill:a==0?"white":"#dcdcdc",stroke:"black"}),s.fillRect(19+n,20,2,2),s.fillRect(29+n,20,2,2),s.fillRect(20+n,25,10,2),n+=50;SCG.images.unit=l;h=document.createElement("canvas");h.width=90;h.height=750;r=h.getContext("2d");n=0;var t=0,o=["#cd7f32","#f2f2f2","#baacc7"],u=["#b87333","#c0c0c0","#876f9e"],f=SCG.globals.materialTypes;for(i=0;i<3;i++)drawFigures(r,[[new V2(2.5+n,30),new V2(2.5+n,15),new V2(5+n,12.5),new V2(7.5+n,15),new V2(7.5+n,30)]],{alpha:1,fill:o[i],stroke:u[i]}),r.fillStyle="#ffd700",r.fillRect(1.5+n,30,7,2),r.fillStyle="#5b3a29",r.fillRect(3.5+n,32,3,3),SCG.globals.items.push({itemName:f[i]+" sword",price:i==0?50:i==1?250:500,position:new V2(-20,-7),attackRadius:10,damage:{min:1+i*5,max:5*Math.pow(2,i+1),crit:i+1},attackRate:1e3,destSourcePosition:new V2(n,0),size:new V2(10,50),itemType:"weapon",unitTypes:["Fighter"]}),t=50,drawFigures(r,[[new V2(7.5+n,20+t),new V2(5+n,22.5+t),{type:"curve",control:new V2(1.5+n,17.5+t),p:new V2(5+n,12.5+t)},new V2(7.5+n,15+t)]],{alpha:1,fill:o[i],stroke:u[i]}),r.fillStyle="#5b3a29",r.fillRect(7+n,15+t,1.5,20),SCG.globals.items.push({itemName:f[i]+" axe",price:i==0?100:i*350,position:new V2(-20,-7),attackRadius:5,damage:{min:5*(i+1),max:15*(i+1),crit:4+i*2},attackRate:3e3,destSourcePosition:new V2(n,t),size:new V2(10,50),itemType:"weapon",unitTypes:["Fighter"]}),t=100,drawFigures(r,[[new V2(5+n,0+t),new V2(7+n,5+t),new V2(5+n,10+t),new V2(3+n,5+t)]],{alpha:1,fill:o[i],stroke:u[i]}),r.fillStyle="#5b3a29",r.fillRect(4+n,10+t,1.5,35),SCG.globals.items.push({itemName:f[i]+" spear",price:i==0?75:i*300,position:new V2(-20,-0),attackRadius:25,damage:{min:i*5,max:15*(i+1),crit:13+i},attackRate:2e3,destSourcePosition:new V2(n,t),size:new V2(10,50),itemType:"weapon",unitTypes:["Defender"]}),t=150,drawFigures(r,[[new V2(5+n,0+t),new V2(7+n,5+t),new V2(5+n,10+t),new V2(3+n,5+t)],[new V2(9+n,12.5+t),new V2(2.5+n,10+t),{type:"curve",control:new V2(0+n,15+t),p:new V2(3.5+n,20+t)}]],{alpha:1,fill:o[i],stroke:u[i]}),r.fillStyle="#5b3a29",r.fillRect(4+n,17+t,1.5,30),SCG.globals.items.push({itemName:f[i]+" halbert",price:i==0?120:i*400,position:new V2(-20,-0),attackRadius:25,damage:{min:5*(i+1),max:25+i*25,crit:5+i},attackRate:4e3,destSourcePosition:new V2(n,t),size:new V2(10,50),itemType:"weapon",unitTypes:["Defender"]}),n+=10;for(n=0,i=0;i<3;i++)t=200,r.lineWidth=2,drawFigures(r,[[new V2(15+n,35+t),{type:"curve",control:new V2(5+n,25+t),p:new V2(15+n,15+t)}]],{alpha:1,stroke:u[i]}),r.lineWidth=1,drawFigures(r,[[new V2(15+n,35+t),new V2(15+n,15+t)]],{alpha:1,stroke:"#black"}),SCG.globals.items.push({itemName:f[i]+"shortBow",price:i==0?60:i==1?350:550,position:new V2(-20,0),attackRadius:100,damage:{min:i*5,max:5*(i+2),crit:25+i*5},attackRate:1250,destSourcePosition:new V2(n,t),size:new V2(20,50),ranged:!0,itemType:"weapon",unitTypes:["Ranged"]}),t=250,r.lineWidth=2,drawFigures(r,[[new V2(15+n,45+t),{type:"curve",control:new V2(0+n,25+t),p:new V2(15+n,5+t)}]],{alpha:1,stroke:u[i]}),r.lineWidth=1,drawFigures(r,[[new V2(15+n,45+t),new V2(15+n,5+t)]],{alpha:1,stroke:"#black"}),SCG.globals.items.push({itemName:f[i]+" bow",price:i==0?150:i==1?500:900,position:new V2(-17.5,0),attackRadius:200,damage:{min:i==0?5:15*i,max:i==0?25:i==1?40:70,crit:3+i*3},attackRate:2500,destSourcePosition:new V2(n,t),size:new V2(20,50),ranged:!0,itemType:"weapon",unitTypes:["Ranged"]}),n+=20;for(drawFigures(r,[[new V2(3+n,25+t),new V2(5+n,22+t),new V2(7+n,25+t)]],{alpha:1,stroke:"#dc143c"}),r.fillStyle="#964b00",r.fillRect(4.5+n,5+t,1,17),drawFigures(r,[[new V2(3+n,7+t),new V2(5+n,3+t),new V2(7+n,7+t)]],{alpha:1,stroke:"#c0c0c0"}),n=0,i=0;i<3;i++)t=300,r.fillStyle=o[i],r.strokeStyle=u[i],r.beginPath(),r.arc(15+n,25+t,6,0,2*Math.PI),r.fill(),r.stroke(),r.fillStyle=u[i],r.beginPath(),r.arc(15+n,25+t,2,0,2*Math.PI),r.fill(),SCG.globals.items.push({itemName:f[i]+" small_shield",price:i==0?30:125*i,position:new V2(17,0),defence:2+i*3,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"shield",unitTypes:["Fighter"]}),t=350,drawFigures(r,[[new V2(15+n,15+t),new V2(22.5+n,20+t),{type:"curve",control:new V2(23+n,32+t),p:new V2(15+n,35+t)},{type:"curve",control:new V2(7+n,32+t),p:new V2(7.5+n,20+t)}]],{alpha:1,fill:o[i],stroke:u[i]}),drawFigures(r,[[new V2(11+n,21+t),new V2(19+n,21+t),new V2(15+n,30+t)]],{alpha:1,fill:u[i]}),SCG.globals.items.push({itemName:f[i]+" medium_shield",price:i==0?50:175*i,position:new V2(17,0),defence:5+i*5,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"shield",unitTypes:["Fighter","Defender"]}),t=400,drawFigures(r,[[new V2(5+n,5+t),new V2(25+n,5+t),new V2(25+n,45+t),new V2(5+n,45+t),new V2(5+n,5+t)]],{alpha:1,fill:o[i],stroke:u[i]}),r.fillStyle=u[i],r.fillRect(10+n,10+t,10,30),SCG.globals.items.push({itemName:f[i]+" large_shield",price:i==0?75:250*i,position:new V2(17,0),defence:10+i*5,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"shield",unitTypes:["Defender"]}),t=450,drawFigures(r,[[new V2(2+n,25+t),{type:"curve",control:new V2(15+n,10+t),p:new V2(28+n,25+t)},new V2(2+n,25+t)]],{alpha:1,fill:o[i],stroke:u[i]}),SCG.globals.items.push({itemName:f[i]+" small_helmet",price:i==0?20:100*i,position:new V2(0,-13),defence:1+i*3,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"helmet",unitTypes:["Ranged","Fighter"]}),t=500,drawFigures(r,[[new V2(2+n,25+t),{type:"curve",control:new V2(15+n,10+t),p:new V2(28+n,25+t)},new V2(2+n,25+t)],[new V2(2+n,25+t),new V2(2+n,35+t),new V2(10+n,25+t)],[new V2(28+n,25+t),new V2(28+n,35+t),new V2(20+n,25+t)]],{alpha:1,fill:o[i],stroke:u[i]}),SCG.globals.items.push({itemName:f[i]+" medium_helmet",price:i==0?40:150*i,position:new V2(0,-13),defence:3+i*3,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"helmet",unitTypes:["Fighter","Defender"]}),t=550,drawFigures(r,[[new V2(2+n,25+t),{type:"curve",control:new V2(15+n,10+t),p:new V2(28+n,25+t)},new V2(2+n,25+t)],[new V2(2+n,25+t),new V2(2+n,35+t),new V2(7+n,35+t),{type:"curve",control:new V2(15+n,30+t),p:new V2(23+n,35+t)},new V2(28+n,35+t),new V2(28+n,25+t)]],{alpha:1,fill:o[i],stroke:u[i]}),SCG.globals.items.push({itemName:f[i]+" full_helmet",price:i==0?50:175*i,position:new V2(0,-13),defence:5+i*5,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"helmet",unitTypes:["Defender"]}),t=600,drawFigures(r,[[new V2(2+n,20+t),new V2(28+n,30+t)],[new V2(2+n,30+t),new V2(28+n,20+t)]],{alpha:1,stroke:u[i]}),r.fillStyle=u[i],r.fillRect(10+n,22+t,10,6),SCG.globals.items.push({itemName:f[i]+" light_armor",price:i==0?50:200*i,position:new V2(0,8),defence:5*(i+1),destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"armor",unitTypes:["Ranged","Fighter"]}),t=650,drawFigures(r,[[new V2(2+n,20+t),{type:"curve",control:new V2(15+n,23+t),p:new V2(28+n,20+t)},new V2(28+n,28+t),{type:"curve",control:new V2(15+n,25+t),p:new V2(2+n,28+t)},new V2(2+n,20+t)]],{alpha:1,fill:o[i],stroke:u[i]}),r.fillStyle=u[i],r.fillRect(4+n,23+t,22,2),SCG.globals.items.push({itemName:f[i]+" medium_armor",price:i==0?75:i==1?300:500,position:new V2(0,8),defence:i==0?7:i==1?13:18,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"armor",unitTypes:["Fighter","Defender"]}),t=700,drawFigures(r,[[new V2(2+n,16+t),{type:"curve",control:new V2(15+n,21+t),p:new V2(28+n,16+t)},new V2(28+n,30+t),{type:"curve",control:new V2(15+n,32+t),p:new V2(2+n,30+t)},new V2(2+n,16+t)]],{alpha:1,fill:o[i],stroke:u[i]}),r.fillStyle=u[i],r.fillRect(4+n,23+t,22,2),SCG.globals.items.push({itemName:f[i]+" full_armor",price:100+i*300,position:new V2(0,8),defence:10+i*6,destSourcePosition:new V2(n,t),size:new V2(30,50),itemType:"armor",unitTypes:["Defender"]}),n+=30;SCG.images.items=h;c=document.createElement("canvas");c.width=300;c.height=50;e=c.getContext("2d");e.lineWidth=5;drawFigures(e,[[new V2(5,3),{type:"curve",control:new V2(50,0),p:new V2(45,47.5)}]],{alpha:1,stroke:"#87cefa"});n=50;drawFigures(e,[[new V2(45+n,5),{type:"curve",control:new V2(50+n,50),p:new V2(5+n,47)}]],{alpha:1,stroke:"#87cefa"});n=100;drawFigures(e,[[new V2(5+n,47),{type:"curve",control:new V2(0+n,0),p:new V2(45+n,3)}]],{alpha:1,stroke:"#87cefa"});n=150;drawFigures(e,[[new V2(45+n,47),{type:"curve",control:new V2(0+n,50),p:new V2(5+n,3)}]],{alpha:1,stroke:"#87cefa"});n=200;e.lineWidth=1;drawFigures(e,[[new V2(1+n,0),new V2(10+n,0),new V2(1+n,10)],[new V2(40+n,0),new V2(49+n,0),new V2(49+n,10)],[new V2(49+n,40),new V2(49+n,50),new V2(40+n,50)],[new V2(10+n,50),new V2(1+n,50),new V2(1+n,40)]],{alpha:1,fill:"#ffd700",stroke:"#998200"});n=250;drawFigures(e,[[new V2(10+n,40),new V2(10+n,20),{type:"curve",control:new V2(25+n,10),p:new V2(40+n,20)},new V2(40+n,40)]],{alpha:1,fill:"#4b4d4b"});e.fillStyle="#5da130";e.fillRect(5+n,40,40,5);e.fillStyle="#1b1116";e.fillRect(15+n,25,20,5);e.fillStyle="#1b1116";e.fillRect(15+n,32,20,2);SCG.images.actions=c});SCG.gameControls.camera.resetAfterUpdate=!0;SCG.scenes.registerScene(e);SCG.scenes.registerScene(o);SCG.scenes.registerScene(s);SCG.scenes.registerScene(i);SCG.scenes.registerScene(t);SCG.scenes.registerScene(r);SCG.scenes.registerScene(u);SCG.scenes.registerScene(f);SCG.scenes.selectScene(e.name);SCG.start()});